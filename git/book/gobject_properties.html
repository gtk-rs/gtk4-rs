<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Properties - GUI development with Rust and GTK 4</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation_linux.html"><strong aria-hidden="true">1.1.</strong> Linux</a></li><li class="chapter-item expanded "><a href="installation_macos.html"><strong aria-hidden="true">1.2.</strong> macOS</a></li><li class="chapter-item expanded "><a href="installation_windows.html"><strong aria-hidden="true">1.3.</strong> Windows</a></li></ol></li><li class="chapter-item expanded "><a href="project_setup.html"><strong aria-hidden="true">2.</strong> Project Setup</a></li><li class="chapter-item expanded "><a href="hello_world.html"><strong aria-hidden="true">3.</strong> Hello World!</a></li><li class="chapter-item expanded "><a href="widgets.html"><strong aria-hidden="true">4.</strong> Widgets</a></li><li class="chapter-item expanded "><a href="gobject_concepts.html"><strong aria-hidden="true">5.</strong> GObject Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="gobject_memory_management.html"><strong aria-hidden="true">5.1.</strong> Memory Management</a></li><li class="chapter-item expanded "><a href="gobject_subclassing.html"><strong aria-hidden="true">5.2.</strong> Subclassing</a></li><li class="chapter-item expanded "><a href="gobject_values.html"><strong aria-hidden="true">5.3.</strong> Generic Values</a></li><li class="chapter-item expanded "><a href="gobject_properties.html" class="active"><strong aria-hidden="true">5.4.</strong> Properties</a></li><li class="chapter-item expanded "><a href="gobject_signals.html"><strong aria-hidden="true">5.5.</strong> Signals</a></li></ol></li><li class="chapter-item expanded "><a href="main_event_loop.html"><strong aria-hidden="true">6.</strong> The Main Event Loop</a></li><li class="chapter-item expanded "><a href="settings.html"><strong aria-hidden="true">7.</strong> Settings</a></li><li class="chapter-item expanded "><a href="saving_window_state.html"><strong aria-hidden="true">8.</strong> Saving Window State</a></li><li class="chapter-item expanded "><a href="list_widgets.html"><strong aria-hidden="true">9.</strong> List Widgets</a></li><li class="chapter-item expanded "><a href="interface_builder.html"><strong aria-hidden="true">10.</strong> Interface Builder</a></li><li class="chapter-item expanded "><a href="todo_app_1.html"><strong aria-hidden="true">11.</strong> Building a Simple To-Do App</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">12.</strong> Actions</a></li><li class="chapter-item expanded "><a href="todo_app_2.html"><strong aria-hidden="true">13.</strong> Manipulating State of To-Do App</a></li><li class="chapter-item expanded "><a href="css.html"><strong aria-hidden="true">14.</strong> CSS</a></li><li class="chapter-item expanded "><a href="resources.html"><strong aria-hidden="true">15.</strong> Resources</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Internationalization</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> Accessibility</div></li><li class="chapter-item expanded affix "><li class="part-title">Useful Libraries</li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Relm4</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> GStreamer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.</strong> Adwaita</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">21.</strong> SourceView</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">22.</strong> Shumate</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">23.</strong> WebKitGTK</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">24.</strong> Zbus and Ashpd</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">25.</strong> Librsvg</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GUI development with Rust and GTK 4</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/gtk-rs/gtk4-rs/tree/master/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="properties"><a class="header" href="#properties">Properties</a></h1>
<p>Properties provide a public API for accessing state of GObjects.</p>
<p>Let us see how this is done by experimenting with the <code>Switch</code> widget.
One of its properties is the <a href="https://docs.gtk.org/gtk4/property.Switch.state.html">state</a>.
According to the GTK docs, it can be read and be written to.
That is why <code>gtk-rs</code> provides corresponding <a href="../docs/gtk4/struct.Switch.html#method.state"><code>state</code></a> and <a href="../docs/gtk4/struct.Switch.html#method.set_state"><code>set_state</code></a> methods.</p>
<p><span class="filename">Filename: listings/gobject_properties/1/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">use gtk::prelude::*;
</span><span class="boring">use gtk::{Align, Box, Orientation, Switch};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span>    // Create the switch
    let switch = Switch::new();

    // Set and then immediately obtain state
    switch.set_state(true);
    let current_state = switch.state();

    // This prints: &quot;The current state is true&quot;
    println!(&quot;The current state is {}&quot;, current_state);
<span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;switch);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>Alternatively, we can use the general <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/trait.ObjectExt.html#tymethod.property"><code>property</code></a> and <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/trait.ObjectExt.html#tymethod.set_property"><code>set_property</code></a> methods.
We use the <a href="https://matematikaadit.github.io/posts/rust-turbofish.html">turbofish</a> syntax to specify the type if it cannot be inferred.</p>
<p><span class="filename">Filename: listings/gobject_properties/2/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">use gtk::prelude::*;
</span><span class="boring">use gtk::{Align, Box, Orientation, Switch};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span>    // Create the switch
    let switch = Switch::new();

    // Set and then immediately obtain state
    switch.set_property(&quot;state&quot;, &amp;true);
    let current_state = switch.property::&lt;bool&gt;(&quot;state&quot;);

    // This prints: &quot;The current state is true&quot;
    println!(&quot;The current state is {}&quot;, current_state);
<span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;switch);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>Both <code>property</code> and <code>set_property</code> panic if the property does not exist, has the wrong type or has the wrong permissions.
This is fine in most situations where these cases are hardcoded within the program.
If this does not apply for your program you might want to use <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/trait.ObjectExt.html#tymethod.try_property"><code>try_property</code></a> and <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/trait.ObjectExt.html#tymethod.try_set_property"><code>try_set_property</code></a> instead.</p>
<p>Properties can not only be accessed via getters &amp; setters, they can also be bound to each other.
Let us see how that would look like for two <code>Switch</code> instances.</p>
<p><span class="filename">Filename: listings/gobject_properties/3/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">use glib::BindingFlags;
</span><span class="boring">use gtk::{glib, Align, Orientation, Switch};
</span><span class="boring">use gtk::{prelude::*, Box};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span>    // Create the switches
    let switch_1 = Switch::new();
    let switch_2 = Switch::new();
<span class="boring">
</span><span class="boring">    switch_1
</span><span class="boring">        .bind_property(&quot;state&quot;, &amp;switch_2, &quot;state&quot;)
</span><span class="boring">        .flags(BindingFlags::BIDIRECTIONAL)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;switch_1);
</span><span class="boring">    gtk_box.append(&amp;switch_2);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>In our case, we want to bind the &quot;state&quot; property of <code>switch_1</code> to the &quot;state&quot; property of <code>switch_2</code>.
We also want the binding to be bidirectional, so we specify this with the <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/struct.BindingFlags.html"><code>BindingFlags</code></a>.</p>
<p><span class="filename">Filename: listings/gobject_properties/3/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">use glib::BindingFlags;
</span><span class="boring">use gtk::{glib, Align, Orientation, Switch};
</span><span class="boring">use gtk::{prelude::*, Box};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span><span class="boring">    // Create the switches
</span><span class="boring">    let switch_1 = Switch::new();
</span><span class="boring">    let switch_2 = Switch::new();
</span><span class="boring">
</span>    switch_1
        .bind_property(&quot;state&quot;, &amp;switch_2, &quot;state&quot;)
        .flags(BindingFlags::BIDIRECTIONAL)
        .build();
<span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;switch_1);
</span><span class="boring">    gtk_box.append(&amp;switch_2);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>Now when we click on one of the two switches, the other one is toggled as well.</p>
<div style="text-align:center"><img src="img/gobject_properties_switches.png" /></div>
<h2 id="adding-properties-to-custom-gobjects"><a class="header" href="#adding-properties-to-custom-gobjects">Adding Properties to Custom GObjects</a></h2>
<p>We can also add properties to custom GObjects.
We can demonstrate that by binding the <code>number</code> of our <code>CustomButton</code> to a property.
For that we need to be able to <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazily evaluate</a> expressions.
The crate <code>once_cell</code> provides the <code>Lazy</code> type which allows us to do that.
<code>once_cell</code> is already part of Rust nightly.
Until it hits stable, we will add it as external dependency.</p>
<p><span class="filename">Filename: listings/Cargo.toml</span></p>
<pre><code class="language-toml">[dependencies]
once_cell = &quot;1&quot;
</code></pre>
<p>Now we define the &quot;number&quot; property within the <code>ObjectImpl</code> implementation.
The <code>properties</code> method describes our set of properties.
When naming our property, we make sure to do that in <a href="https://wiki.c2.com/?KebabCase">kebab-case</a>.
Then we describe its type, range and default value.
We also declare that the property can be read and be written to.
<code>set_property</code> describes how the underlying values can be changed.
<code>property</code> takes care of returning the underlying value.
The formerly private <code>number</code> is now accessible via the <code>property</code> and <code>set_property</code> methods.</p>
<p><span class="filename">Filename: listings/gobject_properties/4/custom_button/imp.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">use glib::{BindingFlags, ParamFlags, ParamSpec, ParamSpecInt, Value};
</span><span class="boring">use gtk::glib;
</span><span class="boring">use gtk::prelude::*;
</span><span class="boring">use gtk::subclass::prelude::*;
</span><span class="boring">use once_cell::sync::Lazy;
</span><span class="boring">
</span><span class="boring">use std::cell::Cell;
</span><span class="boring">
</span><span class="boring">// Object holding the state
</span><span class="boring">#[derive(Default)]
</span><span class="boring">pub struct CustomButton {
</span><span class="boring">    number: Cell&lt;i32&gt;,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// The central trait for subclassing a GObject
</span><span class="boring">#[glib::object_subclass]
</span><span class="boring">impl ObjectSubclass for CustomButton {
</span><span class="boring">    const NAME: &amp;'static str = &quot;MyGtkAppCustomButton&quot;;
</span><span class="boring">    type Type = super::CustomButton;
</span><span class="boring">    type ParentType = gtk::Button;
</span><span class="boring">}
</span><span class="boring">
</span>// Trait shared by all GObjects
impl ObjectImpl for CustomButton {
    fn properties() -&gt; &amp;'static [ParamSpec] {
        static PROPERTIES: Lazy&lt;Vec&lt;ParamSpec&gt;&gt; = Lazy::new(|| {
            vec![ParamSpecInt::new(
                // Name
                &quot;number&quot;,
                // Nickname
                &quot;number&quot;,
                // Short description
                &quot;number&quot;,
                // Minimum value
                i32::MIN,
                // Maximum value
                i32::MAX,
                // Default value
                0,
                // The property can be read and written to
                ParamFlags::READWRITE,
            )]
        });
        PROPERTIES.as_ref()
    }

    fn set_property(&amp;self, _obj: &amp;Self::Type, _id: usize, value: &amp;Value, pspec: &amp;ParamSpec) {
        match pspec.name() {
            &quot;number&quot; =&gt; {
                let input_number = value.get().expect(&quot;The value needs to be of type `i32`.&quot;);
                self.number.replace(input_number);
            }
            _ =&gt; unimplemented!(),
        }
    }

    fn property(&amp;self, _obj: &amp;Self::Type, _id: usize, pspec: &amp;ParamSpec) -&gt; Value {
        match pspec.name() {
            &quot;number&quot; =&gt; self.number.get().to_value(),
            _ =&gt; unimplemented!(),
        }
    }

    fn constructed(&amp;self, obj: &amp;Self::Type) {
        self.parent_constructed(obj);

        // Bind label to number
        // `SYNC_CREATE` ensures that the label will be immediately set
        obj.bind_property(&quot;number&quot;, obj, &quot;label&quot;)
            .flags(BindingFlags::SYNC_CREATE)
            .build();
    }
}
<span class="boring">
</span><span class="boring">// Trait shared by all widgets
</span><span class="boring">impl WidgetImpl for CustomButton {}
</span><span class="boring">
</span><span class="boring">// Trait shared by all buttons
</span><span class="boring">impl ButtonImpl for CustomButton {
</span><span class="boring">    fn clicked(&amp;self, button: &amp;Self::Type) {
</span><span class="boring">        let incremented_number = self.number.get() + 1;
</span><span class="boring">        button.set_property(&quot;number&quot;, &amp;incremented_number);
</span><span class="boring">    }
</span><span class="boring">}
</span></code></pre>
<p>We can immediately take advantage of this new property by binding the &quot;label&quot; property to it.
It even converts the integer value of &quot;number&quot; to the string of &quot;label&quot;.
Now we do not have to adapt the label in the &quot;clicked&quot; callback anymore.</p>
<p>Let us see what we can do with this by creating two custom buttons.</p>
<p><span class="filename">Filename: listings/gobject_properties/4/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">mod custom_button;
</span><span class="boring">
</span><span class="boring">use custom_button::CustomButton;
</span><span class="boring">use glib::BindingFlags;
</span><span class="boring">use gtk::{glib, Align, Orientation};
</span><span class="boring">use gtk::{prelude::*, Box};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span>    // Create the buttons
    let button_1 = CustomButton::new();
    let button_2 = CustomButton::new();
<span class="boring">
</span><span class="boring">    // Assure that &quot;number&quot; of `button_2` is always 1 higher than &quot;number&quot; of `button_1`
</span><span class="boring">    button_1
</span><span class="boring">        .bind_property(&quot;number&quot;, &amp;button_2, &quot;number&quot;)
</span><span class="boring">        // How to transform &quot;number&quot; from `button_1` to &quot;number&quot; of `button_2`
</span><span class="boring">        .transform_to(|_, value| {
</span><span class="boring">            let number = value
</span><span class="boring">                .get::&lt;i32&gt;()
</span><span class="boring">                .expect(&quot;The property needs to be of type `i32`.&quot;);
</span><span class="boring">            let incremented_number = number + 1;
</span><span class="boring">            Some(incremented_number.to_value())
</span><span class="boring">        })
</span><span class="boring">        // How to transform &quot;number&quot; from `button_2` to &quot;number&quot; of `button_1`
</span><span class="boring">        .transform_from(|_, value| {
</span><span class="boring">            let number = value
</span><span class="boring">                .get::&lt;i32&gt;()
</span><span class="boring">                .expect(&quot;The property needs to be of type `i32`.&quot;);
</span><span class="boring">            let decremented_number = number - 1;
</span><span class="boring">            Some(decremented_number.to_value())
</span><span class="boring">        })
</span><span class="boring">        .flags(BindingFlags::BIDIRECTIONAL | BindingFlags::SYNC_CREATE)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // The closure will be called
</span><span class="boring">    // whenever the property &quot;number&quot; of `button_1` gets changed
</span><span class="boring">    button_1.connect_notify_local(Some(&quot;number&quot;), move |button, _| {
</span><span class="boring">        let number = button.property::&lt;i32&gt;(&quot;number&quot;);
</span><span class="boring">        println!(&quot;The current number of `button_1` is {}.&quot;, number);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;button_1);
</span><span class="boring">    gtk_box.append(&amp;button_2);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>We have already seen that bound properties do not necessarily have to be of the same type.
By leveraging <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/struct.BindingBuilder.html#method.transform_to"><code>transform_to</code></a> and <a href="http://gtk-rs.org/gtk-rs-core/stable/latest/docs/glib/object/struct.BindingBuilder.html#method.transform_from"><code>transform_from</code></a>, we can assure that <code>button_2</code> always displays a number which is 1 higher than the number of <code>button_1</code>.</p>
<p><span class="filename">Filename: listings/gobject_properties/4/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">mod custom_button;
</span><span class="boring">
</span><span class="boring">use custom_button::CustomButton;
</span><span class="boring">use glib::BindingFlags;
</span><span class="boring">use gtk::{glib, Align, Orientation};
</span><span class="boring">use gtk::{prelude::*, Box};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span><span class="boring">    // Create the buttons
</span><span class="boring">    let button_1 = CustomButton::new();
</span><span class="boring">    let button_2 = CustomButton::new();
</span><span class="boring">
</span>    // Assure that &quot;number&quot; of `button_2` is always 1 higher than &quot;number&quot; of `button_1`
    button_1
        .bind_property(&quot;number&quot;, &amp;button_2, &quot;number&quot;)
        // How to transform &quot;number&quot; from `button_1` to &quot;number&quot; of `button_2`
        .transform_to(|_, value| {
            let number = value
                .get::&lt;i32&gt;()
                .expect(&quot;The property needs to be of type `i32`.&quot;);
            let incremented_number = number + 1;
            Some(incremented_number.to_value())
        })
        // How to transform &quot;number&quot; from `button_2` to &quot;number&quot; of `button_1`
        .transform_from(|_, value| {
            let number = value
                .get::&lt;i32&gt;()
                .expect(&quot;The property needs to be of type `i32`.&quot;);
            let decremented_number = number - 1;
            Some(decremented_number.to_value())
        })
        .flags(BindingFlags::BIDIRECTIONAL | BindingFlags::SYNC_CREATE)
        .build();
<span class="boring">
</span><span class="boring">    // The closure will be called
</span><span class="boring">    // whenever the property &quot;number&quot; of `button_1` gets changed
</span><span class="boring">    button_1.connect_notify_local(Some(&quot;number&quot;), move |button, _| {
</span><span class="boring">        let number = button.property::&lt;i32&gt;(&quot;number&quot;);
</span><span class="boring">        println!(&quot;The current number of `button_1` is {}.&quot;, number);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;button_1);
</span><span class="boring">    gtk_box.append(&amp;button_2);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>Now if we click on one button, the &quot;number&quot; and &quot;label&quot; properties of the other button change as well.</p>
<div style="text-align:center"><img src="img/gobject_properties_buttons.png"/></div>
<p>The final nice feature of properties is, that you can connect a callback to the event when a property gets changed.
We can do this like this:</p>
<p><span class="filename">Filename: listings/gobject_properties/4/main.rs</span></p>
<pre><code class="language-rust  no_run noplayground"><span class="boring">mod custom_button;
</span><span class="boring">
</span><span class="boring">use custom_button::CustomButton;
</span><span class="boring">use glib::BindingFlags;
</span><span class="boring">use gtk::{glib, Align, Orientation};
</span><span class="boring">use gtk::{prelude::*, Box};
</span><span class="boring">use gtk::{Application, ApplicationWindow};
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    // Create a new application
</span><span class="boring">    let app = Application::builder()
</span><span class="boring">        .application_id(&quot;org.gtk-rs.example&quot;)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Connect to &quot;activate&quot; signal of `app`
</span><span class="boring">    app.connect_activate(build_ui);
</span><span class="boring">
</span><span class="boring">    // Run the application
</span><span class="boring">    app.run();
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn build_ui(app: &amp;Application) {
</span><span class="boring">    // Create the buttons
</span><span class="boring">    let button_1 = CustomButton::new();
</span><span class="boring">    let button_2 = CustomButton::new();
</span><span class="boring">
</span><span class="boring">    // Assure that &quot;number&quot; of `button_2` is always 1 higher than &quot;number&quot; of `button_1`
</span><span class="boring">    button_1
</span><span class="boring">        .bind_property(&quot;number&quot;, &amp;button_2, &quot;number&quot;)
</span><span class="boring">        // How to transform &quot;number&quot; from `button_1` to &quot;number&quot; of `button_2`
</span><span class="boring">        .transform_to(|_, value| {
</span><span class="boring">            let number = value
</span><span class="boring">                .get::&lt;i32&gt;()
</span><span class="boring">                .expect(&quot;The property needs to be of type `i32`.&quot;);
</span><span class="boring">            let incremented_number = number + 1;
</span><span class="boring">            Some(incremented_number.to_value())
</span><span class="boring">        })
</span><span class="boring">        // How to transform &quot;number&quot; from `button_2` to &quot;number&quot; of `button_1`
</span><span class="boring">        .transform_from(|_, value| {
</span><span class="boring">            let number = value
</span><span class="boring">                .get::&lt;i32&gt;()
</span><span class="boring">                .expect(&quot;The property needs to be of type `i32`.&quot;);
</span><span class="boring">            let decremented_number = number - 1;
</span><span class="boring">            Some(decremented_number.to_value())
</span><span class="boring">        })
</span><span class="boring">        .flags(BindingFlags::BIDIRECTIONAL | BindingFlags::SYNC_CREATE)
</span><span class="boring">        .build();
</span><span class="boring">
</span>    // The closure will be called
    // whenever the property &quot;number&quot; of `button_1` gets changed
    button_1.connect_notify_local(Some(&quot;number&quot;), move |button, _| {
        let number = button.property::&lt;i32&gt;(&quot;number&quot;);
        println!(&quot;The current number of `button_1` is {}.&quot;, number);
    });
<span class="boring">
</span><span class="boring">    // Set up box
</span><span class="boring">    let gtk_box = Box::builder()
</span><span class="boring">        .margin_top(12)
</span><span class="boring">        .margin_bottom(12)
</span><span class="boring">        .margin_start(12)
</span><span class="boring">        .margin_end(12)
</span><span class="boring">        .valign(Align::Center)
</span><span class="boring">        .halign(Align::Center)
</span><span class="boring">        .spacing(12)
</span><span class="boring">        .orientation(Orientation::Vertical)
</span><span class="boring">        .build();
</span><span class="boring">    gtk_box.append(&amp;button_1);
</span><span class="boring">    gtk_box.append(&amp;button_2);
</span><span class="boring">
</span><span class="boring">    // Create a window
</span><span class="boring">    let window = ApplicationWindow::builder()
</span><span class="boring">        .application(app)
</span><span class="boring">        .title(&quot;My GTK App&quot;)
</span><span class="boring">        .child(&amp;gtk_box)
</span><span class="boring">        .build();
</span><span class="boring">
</span><span class="boring">    // Present the window
</span><span class="boring">    window.present();
</span><span class="boring">}
</span></code></pre>
<p>Now, whenever the &quot;number&quot; property gets changed, the closure gets executed and prints the current value of &quot;number&quot;.</p>
<p>Introducing properties to your custom GObjects is useful if you want to</p>
<ul>
<li>allow consumers to be able to access internal state</li>
<li>bind state of (different) GObjects</li>
<li>notify consumers whenever a property value changes</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="gobject_values.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="gobject_signals.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="gobject_values.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="gobject_signals.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
